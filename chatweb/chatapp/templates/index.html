<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    
    <title>index</title>

</head>
<body>

{%include 'header.html' %}


<div class='container' style=' text-align:center; width: 100%; height: 540px; display: flex;
     justify-content: space-between; background-color:white;'>

    <div style="width: 55%; height: 100%; box-sizing: border-box;">
      <h3>Group Name: <span style='color:blue;'>{{groupname}}</span></h3>
      <textarea id="chat-log" cols="80" rows="20" style='height:60%;background-color:#ECE5DD;border-radius:15px;'>
        {% for chat in chats %}
          {{chat.content}}
        {% endfor %}
      </textarea><br><br>
      <input id="chat-message-input" type="text" size="80"style='background-color:#CCFFCC;border-radius:10px;'><br>
      <input id="chat-message-submit" type="button" value="Send >>" style='background-color:#ECE5DD;'>
      {{ groupname|json_script:"group-name" }}
  </div>
{% comment %} some List og group name for chat {% endcomment %}
  <div style="width: 35%; height: 100%; border: 1px solid #999; box-sizing: border-box;">
      <h5>click only 1 group link below</h5>
    <ul>
      <li><a href='http://127.0.0.1:8000/india/'>india</a></li>
      <li><a href='http://127.0.0.1:8000/pakistan/'>pakistan</a></li>
      <li><a href='http://127.0.0.1:8000/srilanka/'>srilanka</a></li>
      <li><a href='http://127.0.0.1:8000/japan/'>japan</a></li>
      <li><a href='http://127.0.0.1:8000/china/'>china</a></li>
      <li><a href='http://127.0.0.1:8000/Nepal/'>nepal</a></li>
    </ul>
  </div>

</div>
{% comment %} -----------------------------script    js part ---------------------------------------{% endcomment %}
  <script>
    const groupName = JSON.parse(document.getElementById("group-name").textContent)
    console.log("Group Name...", groupName)
    var ws = new WebSocket(
      'ws://'
      + window.location.host
      + '/ws/jwc/'
      + groupName
      + '/'
    )
    ws.onopen = function () {
      console.log('WebSocket Connection Open...')
    };

    ws.onmessage = function (event) {
      console.log("Message received from server...", event.data)
      const data = JSON.parse(event.data)
      console.log("Data...", data)
      document.querySelector('#chat-log').value += (data.message + '\n')
    }

    ws.onclose = function (event) {
      console.error('Chat socket closed unexpectedly');
    };

    document.getElementById("chat-message-submit").onclick = function (event) {
      const messageInputDom = document.getElementById("chat-message-input")
      const message = messageInputDom.value
      ws.send(JSON.stringify({
        'msg': message
      }))
      messageInputDom.value = '';
    }

  </script>

</body>
</html>